<sb-layout-dashboard [static]="true">
<sb-dashboard-head title="Organisations" [hideBreadcrumbs]="false"></sb-dashboard-head>
<mat-tab-group mat-align-tabs="start">
    <mat-tab>
        <ng-template mat-tab-label>
            <fa-icon [icon]='["fas", "users"]'></fa-icon>
            <span class="p-2">Organisations</span>
        </ng-template>
        <mat-expansion-panel *ngIf="editOrg" class="mt-3">
            <mat-expansion-panel-header>
              <mat-panel-title>
                {{title}}
              </mat-panel-title>
            </mat-expansion-panel-header>
            <ng-template matExpansionPanelContent>          
                <form #f="ngForm" class="form-group">
                    <div class=" col-sm-6 col-lg-4 col-md-4 vertical-center">
                        <div class="image">
                            <img  [src]="imageSrc" *ngIf="imageSrc" style="position:relative;
                            left: calc(10%); height: 50px; width: 50px"> 
                            <span  style="position:relative;
                            top: calc(20%); left: calc(30%);"*ngIf="!imageSrc">Logo</span>                                                              
                            <input
                                style="display: none;"
                                [(ngModel)]="organization.logo" 
                                id="upload-photo"
                                type="file"
                                name="logo" 
                                (change)="onFileChange($event)">         
                        </div>
                        <label style="position:relative;
                            top: calc(10%); left: calc(70%);"for="upload-photo">
                            <fa-icon title="Upload logo" [icon]='["fas", "upload"]'></fa-icon>
                        </label>                              
                    </div>
                    <div class="col-11 float-right">
                        <mat-form-field class="col-sm-6 col-lg-6 col-md-6">
                            <mat-label>Name: </mat-label>
                            <input matInput type="text" name="name" id="name" [(ngModel)]="organization.name" />
                        </mat-form-field>
                        <mat-form-field class="col-sm-6 col-lg-6 col-md-6">
                            <mat-label>Description: </mat-label>
                            <input matInput  type="text" name="description" id="description" [(ngModel)]="organization.description" />
                        </mat-form-field>
                        <mat-form-field class="col-sm-4 col-lg-4 col-md-4">
                        <mat-label>Date de création: </mat-label>
                            <input matInput   type="date" name="inc" id="inc" [(ngModel)]="organization.inceptionDate" />
                        </mat-form-field>
                        
                        <mat-form-field class="col-sm-4 col-lg-4 col-md-4">
                            <mat-label>Cessation Date: </mat-label>
                            <input matInput type="date" name="cess" id="cess" [(ngModel)]="organization.cessationDate" />
                        </mat-form-field>
                        <mat-form-field class="col-sm-4 col-lg-4 col-md-4">
                            <mat-select [ngModelOptions]="{standalone: true}" [(ngModel)]="organization.type" placeholder="Select A Type">
                            <mat-option *ngFor="let type of types" [value]="type">{{ type.name }}</mat-option>
                            </mat-select>
                        </mat-form-field>                            
                        <mat-action-row>
                            <button mat-button  color="primary"  *ngIf="!isUpdate"  type="submit" (click)="createOrg()"> <mat-icon>save_alt</mat-icon>save</button>
                            <button mat-button  color="primary" *ngIf="isUpdate"  type="submit" (click)="updateOrg()"> <mat-icon>save_alt</mat-icon> save</button>
                            <button mat-button  type="reset" color="accent" > <mat-icon>restore</mat-icon>reset </button> 
                        </mat-action-row>                           
                    </div>
                </form>
            </ng-template>
        </mat-expansion-panel>
        <button mat-button color="primary" (click)="editOrg = true; title='New Organisation'" class="float-right p-2"><mat-icon>add_circle_outline</mat-icon>add new organization</button>
        <div class="table-responsive" *ngIf="organizations && organizations.length !== 0">
            <caption>
                Organisations List
            </caption>
            <table class="table table-striped">
                <thead>
                    <th> #</th>
                    <th>Name</th>
                    <th>Description</th>
                    <th>Inception Date</th>
                    <th>Cessation Date</th>
                    <th>Type</th>
                    <th >Action</th>
                </thead>
                <tbody>
                    <tr *ngFor="let org of organizations">
                        <td>{{org.id}}</td>
                        <td>{{org.name}}</td>
                        <td>{{org.description}}</td>
                        <td>{{org.inceptionDate | date:'dd-MM-yyyy'}}</td>
                        <td>{{org.cessationDate | date:'dd-MM-yyyy'}}</td>
                        <td>{{org.type?.name}}</td>
                        <td class="p-2"> 
                            <button mat-button color="primary" (click)="organization = org; editOrg = true; isUpdate = true; title='Edit Organization'"> <mat-icon>edit</mat-icon> edit</button>                               
                            <button mat-button color="warn" (click)="deleteOrg(org)" > <mat-icon>delete</mat-icon> delete </button> 
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </mat-tab>
    <mat-tab label="Types d'organization">
        <mat-card *ngIf="showTypeForm"> 
            <mat-card-title>
                {{typeTitle}}
            </mat-card-title>
            <mat-card-content>        
                <form #f1="ngForm">
                    <mat-form-field class="col-sm- col-lg-6 col-md-6">
                        <mat-label>Name: </mat-label>
                        <input matInput type="text" name="name" id="name" [(ngModel)]="type.name" />
                    </mat-form-field>
                    <mat-form-field class="col-sm-6 col-lg-6 col-md-6">
                        <mat-label>Description: </mat-label>
                        <input matInput  type="text" name="description" id="description" [(ngModel)]="type.description" />
                    </mat-form-field>            
                    <mat-action-row>
                        <button mat-button color="primary"  *ngIf="!isUpdate" type="submit" (click)="createType()"> <mat-icon>save_alt</mat-icon></button>
                        <button mat-button color="primary"  *ngIf="isUpdate" type="submit" (click)="updateType()"> <mat-icon>save_alt</mat-icon></button>
                        <button mat-button color="accent" type="reset" > <mat-icon>undo</mat-icon>reset</button>
                    </mat-action-row>
                </form> 
            </mat-card-content> 
        </mat-card>
        <mat-action-row>
            <button mat-button class="float-right" color="primary" (click)="showTypeForm = true; typeTitle = 'New Organization Type'"><mat-icon>add_circle_outline</mat-icon>add organization type</button>
        </mat-action-row>
        <div class="table-responsive" *ngIf="types && types.length !== 0">
            <caption>
                List of organizations types
            </caption>
            <table class="table table-striped">
                <thead>
                    <th> #</th>
                    <th>Name</th>
                    <th>Description</th>
                    <th >Action</th>
                </thead>
                <tbody>
                    <tr *ngFor="let typ of types">
                        <td>{{typ.id}}</td>
                        <td>{{typ.name}}</td>
                        <td>{{typ.description}}</td>
                        <td> 
                            <button mat-button color="primary" (click)="type = typ; showTypeForm=true; isUpdate = true; typeTitle='Edit organization Type'">  <mat-icon>edit</mat-icon>edit</button>
                            &nbsp;
                            <button mat-button color="warn" (click)="deleteType(typ)"> <mat-icon>delete</mat-icon> delete</button> 
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </mat-tab>    
    <mat-tab> 
        <ng-template mat-tab-label>
            <mat-icon>table</mat-icon>
            <span class="p-2">Social reason</span>
        </ng-template>
        <div>
        </div>
    </mat-tab>
    <mat-tab> 
        <ng-template mat-tab-label>
            <mat-icon>edit</mat-icon>
            <span class="p-2">HOrBAC Editor</span>
        </ng-template>
        <div>
            <form>
                <!-- <ckeditor [editor]="Editor" data='<p>Hello, world!</p>'></ckeditor> !-->
                <!-- <json-editor (change) = "formChanges($event)" [options]="editorOptions" [(data)]="data" #editor></json-editor> -->
                <textarea name="editor" id="editor" class="col-15" cols="168" rows="10" [(ngModel)] = "data"></textarea>
                <button  mat-button color="primary" (click)="changeLog()"  type="submit"> 
                    <mat-icon>save_alt</mat-icon> submit
                </button>
                <button mat-button color="warn" class="m-2" type="reset"> <mat-icon>clear</mat-icon>reset</button>
            </form>
        </div>
    </mat-tab>
    <mat-tab> 
        <ng-template mat-tab-label>
            <fa-icon [icon]='["fas", "cog"]'></fa-icon>
            <span class="p-2">Paramètres</span>
        </ng-template>
        <mat-card class="result">
            <mat-card-content>
              <h2 class="example-h2">Global Setup</h2>          
              <section class="example-section">
                <mat-slide-toggle
                    class="example-margin"
                    [color]="color"
                    [checked]="checked"
                    [disabled]="disabled">
                  Allow multiple Units for an employee
                </mat-slide-toggle>
              </section>
              <section class="example-section">
                <mat-slide-toggle
                    class="example-margin"
                    [color]="color"
                    [checked]="checkedp2"
                    (change)="saveParam2()"
                    [disabled]="disabledp2">
                  Allow maximum employee per units
                </mat-slide-toggle>
                <mat-form-field > 
                    <mat-label>Max Employee per units: </mat-label>                                                           
                    <input [disabled]="!checkedp2" matInput id="param2" name="param2" type="number"  [(ngModel)]="maxEmployee"/>
                </mat-form-field> 
              </section>
            </mat-card-content>
        </mat-card>
    </mat-tab>
  </mat-tab-group>
</sb-layout-dashboard>